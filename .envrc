#!/usr/bin/env bash
# .envrc - direnv configuration for automatic virtual environment activation
# Install direnv: https://direnv.net/docs/installation.html
# Usage: Run 'direnv allow' in this directory to enable

# Get the absolute path of the project directory
PROJECT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Remove any incorrect paths with hyphens from PATH
export PATH=$(echo "$PATH" | tr ':' '\n' | grep -v "model-guided-research" | tr '\n' ':' | sed 's/:$//')

# Set up the virtual environment with the correct path
export VIRTUAL_ENV="${PROJECT_DIR}/.venv"
export PATH="${VIRTUAL_ENV}/bin:${PATH}"

# Clear command hash table to ensure new commands are found
hash -r 2>/dev/null || true

# Set virtual env prompt
export VIRTUAL_ENV_PROMPT="(model-guided-research) "

# Set development environment variables
export ENVIRONMENT="${ENVIRONMENT:-development}"
export PYTHONPATH="${PROJECT_DIR}/src:${PYTHONPATH}"
export PYTHONDONTWRITEBYTECODE=1
export PYTHONUNBUFFERED=1

# Load .env file if it exists
if [ -f "${PROJECT_DIR}/.env" ]; then
    set -a
    source "${PROJECT_DIR}/.env"
    set +a
fi

# Development convenience aliases
alias test="pytest"
alias lint="ruff check ."
alias format="ruff format ."
alias typecheck="mypy src/"

# Display environment info when entering directory
if [ -n "$DIRENV_IN_ENVRC" ]; then
    echo ""
    echo "ðŸš€ Model Guided Research Development Environment"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "âœ… Virtual environment: $(basename $VIRTUAL_ENV)"
    echo "ðŸ“ Project: $(basename $PROJECT_DIR)"
    echo "ðŸ Python: $(python --version 2>&1)"
    echo "âš¡ Environment: $ENVIRONMENT"
    echo ""
fi 